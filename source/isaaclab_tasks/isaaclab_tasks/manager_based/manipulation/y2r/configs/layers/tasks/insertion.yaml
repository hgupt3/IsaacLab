# ==============================================================================
# Insertion Task Layer - Nut/Bolt Assembly
# ==============================================================================
# Task definition only - no play/mode settings.
# Phase: Grasp nut from above, hover over fixed bolt (basic setup).
# Uses push-T infrastructure: nut=object, bolt=outline (kinematic + contacts).
# ==============================================================================

trajectory:
  segments:
    - name: "grasp"
      type: "waypoint"
      pose: null              # Computed: start_poses
      duration: 2.5

    - name: "hover_high"
      type: "waypoint"
      # Hover above bolt
      pose: [-0.65, 0.0, 0.38, 1.0, 0.0, 0.0, 0.0]
      duration: 6.0
      hand_coupling: "position_only"

    - name: "hover_low"
      type: "waypoint"
      # Lower hover above bolt
      pose: [-0.65, 0.0, 0.32, 1.0, 0.0, 0.0, 0.0]
      duration: 2.0
      hand_coupling: "position_only"

    - name: "insert"
      type: "waypoint"
      # Pre-threading position
      pose: [-0.65, 0.0, 0.29, 1.0, 0.0, 0.0, 0.0]
      duration: 7.0
      hand_coupling: "position_only"

    - name: "thread"
      type: "helical"
      axis: [0, 0, -1]           # Rotate around Z-axis (vertical)
      angular_velocity: 0.628    # Threading angular speed (rad/s)
      translation: [0, 0, -0.005]  # Threading descent (meters)
      duration: 40.0
      hand_coupling: "position_only"  # Palm descends with nut, wrist orientation fixed
      # hand_orientation: null will use orientation from previous segment (hover_low)

    - name: "release"
      type: "waypoint"
      pose: [-0.65, 0.0, 0.31, 1.0, 0.0, 0.0, 0.0]              # Object stays at threaded position
      duration: 2.0
      hand_coupling: "none"   # Hand decouples and retreats

hand_trajectory:
  enabled: true
  grasp_sampling:
    fixed_origin_offset: [0.0, -0.02, 0]
    fixed_direction: [0, 0, 1]  # Grasp from above
    fixed_hand_roll: 0.0
    standoff_range: [0.05, 0.05]
    approach_distance: 0.15
    align_fraction: 0.7
  keypoints:
    count_weights: [1.0]        # No keypoints for threading task

# Use push-T config for nut/bolt setup
push_t:
  enabled: true
  object_usd: "assets/nut/nut4.usd"       # Nut = object (manipulated)
  outline_usd: "assets/bolt/bolt_chamfered.usd"     # Bolt = outline (fixed target)
  object_scale: 1.46                                      # Nut scale
  outline_position: [-0.65, 0.0]                         # Bolt fixed position on table
  object_rotation: [1.0, 0.0, 0.0, 0.0]                  # Nut orientation
  outline_rotation: [1.0, 0.0, 0.0, 0.0]                 # Bolt orientation
  outline_has_contacts: true      # Enable collisions on bolt
  outline_is_kinematic: true      # Bolt is fixed/unmovable
  outline_has_gravity: false      # No gravity on bolt

  rolling_window: 3.0
  min_speed: 0.05

goal:
  x_range: [-0.65, -0.65]
  y_range: [0.0, 0.0]

randomization:
  object:
    scale: [1.5, 1.5]           # Fixed scale
    mass_scale: [0.12, 0.12]
    static_friction: [1.0, 1.0]
    dynamic_friction: [1.0, 1.0]
  reset:
    object_x: [0.05, 0.1]       # X randomization
    object_y: [0.1, 0.2]     # Y randomization
    object_yaw: [0.0, 0.0]     # Yaw randomization

terminations:
  trajectory_deviation:
    position_threshold: [1.0, 1.0]     # Generous thresholds for early phase
    rotation_threshold: [3.0, 3.0]

  hand_pose_deviation:
    position_threshold: [0.25, 0.25]        # Position threshold (meters)
    rotation_threshold: [2.5, 2.5]          # Rotation threshold (radians)

procedural_objects:
  generation:
    num_shapes: 0  
